# Development Plan: Issues #9-14

**Date:** 2026-02-09
**Scope:** 6 issues covering guides, educational content, comparison tools, deals, and mousepad filtering
**Scoping notes:** #11/#12 are V1 only (static MDX). #13 is frontend only (CRM backend is dazz-infra). No Vitest yet, so unit tests are deferred.

---

## Codebase Snapshot

- **Framework:** Astro 5 SSG + TailwindCSS 4 (via `@tailwindcss/vite`)
- **Existing pages:** 10 `.astro` files under `src/pages/` (index, picks, reviews/*, work-with-me, disclosure, privacy, terms, 404)
- **MDX integration:** NOT configured -- `@astrojs/mdx` needs to be installed and added to `astro.config.mjs`
- **Content collections:** NOT configured -- no `src/content/` directory exists
- **Shared lib:** `api.ts` (cached build-time fetch), `types.ts` (Product, CategorySlug, etc.), `specs.ts`, `products.ts`, `youtube.ts`
- **Components:** `BaseLayout.astro`, `PickCard.astro`, `EmptyState.astro`, `AffiliateDisclosure.astro`, `NewsletterSignup.astro`
- **API pattern:** Build-time only. `getProducts()` has module-level cache. All external URLs validated with `new URL()` + protocol check.
- **Nav links:** Picks, Reviews, Work With Me (header + footer). New sections will need nav additions.

---

## Dependency Graph

```
Shared Infra (MDX + content collections)
  |
  +-- #9  Best Of Guides (needs MDX, needs content collections, needs product API)
  +-- #10 HE/TMR Explainer Hub (needs MDX, needs content collections, pure static content)
  +-- #11 Comparison Table V1 (needs MDX for the page shell)
  +-- #12 Buying Guide V1 (needs MDX for the page)
  |
  #13 Deal Tracker (standalone -- no MDX needed, Astro pages + new component)
  #14 Mousepad Filtering (standalone -- enhances existing /reviews/mousepads page)
```

Issues #13 and #14 have zero dependency on MDX infra and can be done in any order. Issues #9-12 all depend on the shared MDX/content-collections setup.

---

## Recommended Issue Order

1. **Shared infra** (MDX + content collections setup)
2. **#10** -- HE/TMR Explainer Hub (pure MDX content, no API dependency, proves the content pipeline works)
3. **#9** -- Best Of Guides (MDX + API product resolution, builds on #10's patterns)
4. **#12** -- Buying Guide V1 (single static MDX page, lightweight)
5. **#11** -- Comparison Table V1 (static MDX + vanilla JS sorting, builds on product data patterns from #9)
6. **#14** -- Mousepad Filtering (enhancement to existing page, independent)
7. **#13** -- Deal Tracker frontend (new page + component, independent)

Issues #13 and #14 can run in parallel with anything. The ordering above is optimized for: shared infra first, then simplest MDX consumer (#10) to validate the setup, then progressively more complex consumers.

---

## Shared Infrastructure (pre-#9)

These tasks are prerequisites for issues #9-12. They should be a single branch (`infra/mdx-content-collections`) or folded into the first issue branch that needs them (likely #10).

- [x] **Install `@astrojs/mdx` and configure Astro integration**
  - `npm install @astrojs/mdx`
  - Add `mdx()` to `integrations` array in `astro.config.mjs`
  - Verify build still passes with zero MDX files
  - _Commit: `feat: add MDX integration to Astro config`_

- [x] **Set up Astro content collections for guides and learn articles**
  - Create `src/content/config.ts` with collection schemas:
    - `guides` collection (for #9): frontmatter schema with `title`, `description`, `slug`, `lastUpdated`, `products` (string array of slugs), `category` (optional), `order` (optional)
    - `learn` collection (for #10): frontmatter schema with `title`, `description`, `slug`, `order`, `section` (for sidebar grouping)
  - Create empty directories: `src/content/guides/`, `src/content/learn/`
  - _Commit: `feat: define content collection schemas for guides and learn sections`_

- [x] **Create MDX layout component for prose content**
  - `src/layouts/ArticleLayout.astro` -- wraps MDX content in `BaseLayout` with:
    - Breadcrumb nav (configurable via props)
    - `prose` class container (dark theme: `prose-invert`)
    - Optional sidebar slot (for #10's sidebar nav)
    - "Last updated" date display (for #9's guides)
    - Table of contents slot
  - _Commit: `feat: add ArticleLayout component for MDX prose pages`_

---

## Issue #9: Best Of Guides

**Branch:** `issue-9-best-of-guides`

- [x] **Create `ProductCardEmbed.astro` component for use inside MDX**
  - Accepts a `slug` string prop
  - Calls `getProductBySlug()` at build time to resolve live product data (price, rating, image, affiliate link)
  - Renders a horizontal card layout (different from `PickCard` grid card): image left, name + rating + price + verdict + buy link right
  - Graceful fallback if slug not found: renders "Product not found" placeholder with the slug name (no build failure)
  - Include `AffiliateDisclosure` at bottom of any guide that has at least one resolved affiliate link
  - _Commit: `feat: add ProductCardEmbed component for MDX guide pages`_

- [x] **Create guide index page and dynamic route**
  - `src/pages/guides/index.astro` -- lists all guides from the `guides` content collection, sorted by `lastUpdated` descending
  - `src/pages/guides/[...slug].astro` -- renders individual guide MDX using `ArticleLayout`
    - Auto-generate table of contents from `## ` headings in the MDX
    - Inject affiliate disclosure if any product cards have affiliate links
    - Display "Last updated: [date]" prominently at top
  - _Commit: `feat: add guide index and dynamic route pages`_

- [x] **Write initial 3-5 guide MDX files**
  - `src/content/guides/best-gaming-mice-under-50.mdx`
  - `src/content/guides/best-wireless-gaming-mice.mdx`
  - `src/content/guides/best-hall-effect-keyboards.mdx`
  - `src/content/guides/best-budget-mousepads.mdx`
  - `src/content/guides/best-iems-for-gaming.mdx`
  - Each follows the template: intro paragraph, methodology blurb, ranked `<ProductCardEmbed slug="..." />` entries with mini-reviews, FAQ section, affiliate disclosure
  - SEO: descriptive `title` and `description` frontmatter targeting long-tail keywords
  - Internal links to individual review pages (`/reviews/{category}/{slug}`)
  - _Commit: `content: add initial best-of guides (mice, wireless, HE keyboards, mousepads, IEMs)`_

- [x] **Add "Guides" to site navigation**
  - Add `/guides` link to header nav and footer links in `BaseLayout.astro`
  - _Commit: `feat: add Guides link to site navigation`_

---

## Issue #10: HE/TMR Keyboard Explainer Hub

**Branch:** `issue-10-learn-hub`

- [x] **Create learn section layout with sidebar navigation**
  - `src/layouts/LearnLayout.astro` -- extends `ArticleLayout` with a fixed sidebar:
    - Sidebar lists all articles in the `learn` collection, grouped by `section` frontmatter field, sorted by `order`
    - Current article highlighted in sidebar
    - Mobile: sidebar collapses to a dropdown or hamburger menu
    - Responsive: sidebar on left (desktop), above content (mobile)
  - _Commit: `feat: add LearnLayout with sidebar navigation for /learn section`_

- [x] **Create learn index and dynamic route pages**
  - `src/pages/learn/index.astro` -- hub page with section headings and article cards linking to each article
  - `src/pages/learn/[...slug].astro` -- renders individual learn article MDX using `LearnLayout`
  - _Commit: `feat: add learn index and dynamic route pages`_

- [x] **Write 4-6 educational articles**
  - `src/content/learn/what-is-hall-effect.mdx`
  - `src/content/learn/what-is-tmr.mdx`
  - `src/content/learn/hall-effect-vs-tmr.mdx`
  - `src/content/learn/rapid-trigger-explained.mdx`
  - `src/content/learn/analog-input-explained.mdx`
  - `src/content/learn/he-keyboard-buyers-guide.mdx`
  - Each has: intro, explanation with diagrams/images (placeholder SVGs acceptable for V1), cross-links to keyboard reviews in the review database
  - Buyer's guide article links to the "Best HE Keyboards" guide from #9
  - SEO: target educational queries ("what is rapid trigger", "hall effect vs mechanical keyboard")
  - _Commit: `content: add HE/TMR keyboard educational articles`_

- [x] **Add "Learn" to site navigation**
  - Add `/learn` link to header nav and footer links in `BaseLayout.astro`
  - _Commit: `feat: add Learn link to site navigation`_

---

## Issue #11: Comparison Table V1 (Static)

**Branch:** `issue-11-comparison-table`

**Scope constraint:** V1 only. Static MDX page with a hand-curated HTML table. No Preact island, no dynamic product selection. V2 (interactive) is gated on 30+ published products.

- [x] **Create comparison table page with sortable columns**
  - `src/pages/compare.astro` (or `src/content/guides/mouse-comparison-table.mdx` if we want it in the guides collection -- recommend standalone `.astro` page since it has significant JS)
  - Static table of top 10-15 mice with columns: Name, Weight, Sensor, DPI, Polling Rate, Connectivity, Price, Rating
  - Data sourced from `getProducts()` at build time, filtered to mice category, sorted by rating descending
  - Vanilla JS column sorting: click header to sort asc/desc, visual indicator (arrow) on active sort column
  - Data attributes on `<td>` elements for numeric sort (`data-sort-value`)
  - Mobile: horizontal scroll with sticky first column (product name)
  - Link each product name to its review page
  - _Commit: `feat: add static mouse comparison table with column sorting`_

- [x] **Add "Compare" link to navigation or Reviews section**
  - Add a "Compare Mice" link card on `/reviews/mice` page and/or a link in the main nav dropdown
  - _Commit: `feat: add Compare link to reviews navigation`_

---

## Issue #12: Buying Guide V1 (Static)

**Branch:** `issue-12-buying-guide`

**Scope constraint:** V1 only. Static MDX decision flowchart -- no Preact quiz. V2 (interactive) is gated on 30+ published mice.

- [x] **Create static mouse buying guide page**
  - `src/content/guides/mouse-buying-guide.mdx` -- lives in the guides collection alongside best-of guides
  - Structure:
    - Intro: "How to choose a gaming mouse"
    - Decision sections by criteria: hand size, grip style, budget tier, wired vs wireless, weight preference, primary game genre
    - Each section: brief explanation + "If [criteria], consider these:" with 2-3 `<ProductCardEmbed>` recommendations
    - Summary flowchart as a styled list/table (text-based, not an image -- accessible and maintainable)
    - FAQ section
  - Cross-links to individual review pages and the comparison table (#11)
  - _Commit: `content: add static mouse buying guide with decision flowchart`_

Note: No separate page route needed -- this is just another guide in the `guides` content collection and will be served at `/guides/mouse-buying-guide` by the existing dynamic route from #9.

---

## Issue #13: Deal Tracker (Frontend Only)

**Branch:** `issue-13-deal-tracker`

**Scope constraint:** Frontend only. The `Deal` model, CRM UI, and `GET /api/v1/public/deals` endpoint are out of scope (dazz-infra repo). This builds the page shell with mock/empty data so the frontend is ready when the API ships.

- [x] **Define `Deal` type and stub API function**
  - Add `Deal` interface to `src/lib/types.ts`:
    ```ts
    interface Deal {
      id: number;
      product_id: number;
      product_name: string;
      product_slug: string;
      category_slug: CategorySlug | null;
      image_url: string | null;
      normal_price: number;
      sale_price: number;
      retailer: string;
      affiliate_link: string | null;
      start_date: string;
      end_date: string;
      is_active: boolean;
    }
    ```
  - Add `getDeals()` to `src/lib/api.ts` that calls `GET /api/v1/public/deals` (will return empty array until CRM ships the endpoint -- same graceful pattern as `getProducts()`)
  - _Commit: `feat: add Deal type and getDeals API function`_

- [x] **Create DealCard component**
  - `src/components/DealCard.astro`
  - Displays: product image, product name, original price (strikethrough), sale price, savings percentage, retailer name, affiliate link button, expiration date
  - Expired state: grayed out card, "Expired" badge, strikethrough on sale price, disabled buy button
  - URL validation on affiliate_link (same `safeUrl` pattern as PickCard)
  - _Commit: `feat: add DealCard component with expired state`_

- [x] **Create /deals page with empty state**
  - `src/pages/deals.astro`
  - Calls `getDeals()` at build time
  - Active deals displayed in a grid of `DealCard` components
  - Expired deals (within last 7 days): shown in a separate "Recently Expired" section below active deals, or hidden if older than 7 days
  - Empty state when no deals: "No active deals right now. Subscribe for deal alerts!" with `NewsletterSignup` component
  - _Commit: `feat: add /deals page with deal grid and empty state`_

- [x] **Add "Deals" to site navigation**
  - Add `/deals` link to header nav and footer links in `BaseLayout.astro`
  - _Commit: `feat: add Deals link to site navigation`_

---

## Issue #14: Mousepad-Specific Filtering

**Branch:** `issue-14-mousepad-filtering`

- [x] **Add mousepad filter constants and helpers**
  - Add to `src/lib/types.ts` (or a new `src/lib/mousepad-filters.ts`):
    - `SURFACE_TYPES`: `['Speed', 'Control', 'Hybrid']`
    - `MOUSEPAD_SIZES`: `['Small', 'Medium', 'Large', 'XL', 'Desk Mat']`
    - Helper to extract typed mousepad specs from `Product.specs` (already typed as `MousepadSpecs` in types.ts, but need runtime extraction with defaults)
  - _Commit: `feat: add mousepad filter constants and spec extraction helper`_

- [x] **Enhance /reviews/mousepads with filter dropdowns and table view toggle**
  - Modify `src/pages/reviews/[category]/index.astro` to detect when `categorySlug === 'mousepads'` and render additional filter UI:
    - Surface type dropdown (Speed / Control / Hybrid / Any)
    - Size dropdown (S / M / L / XL / Desk Mat / Any)
    - Speed rating range (slider or dropdown: 1-10)
    - Control rating range (slider or dropdown: 1-10)
  - Add a view toggle: Grid view (existing `PickCard` grid) vs Table view
  - Table view: all mousepads in a sortable HTML table with columns: Name, Surface Type, Speed, Control, Size, Thickness, Price, Rating
  - Vanilla JS filtering + sorting (same pattern as `/reviews/index.astro` filter script)
  - Data attributes on table rows for client-side filtering
  - Specs come from `product.specs` which is already typed as `MousepadSpecs` -- extract at build time and render as data attributes
  - _Commit: `feat: add mousepad-specific filters and table view to /reviews/mousepads`_

---

## Navigation Summary

After all issues are complete, the site nav should include:

| Link | Route | Source |
|------|-------|--------|
| My Picks | `/picks` | existing |
| Reviews | `/reviews` | existing |
| Guides | `/guides` | #9 |
| Learn | `/learn` | #10 |
| Compare | `/compare` | #11 |
| Deals | `/deals` | #13 |
| Work With Me | `/work-with-me` | existing |

That is 7 nav items, which is getting full. Consider grouping some into a dropdown (e.g., "Resources" containing Guides, Learn, Compare) during implementation. This is a design decision to make during #9/#10.

---

## Open Questions / Decisions Needed

1. **Nav grouping:** 7 top-level nav links is crowded on mobile. Do we want a "Resources" dropdown for Guides/Learn/Compare, or keep them flat?

2. **Shared infra branch strategy:** Should the MDX + content collections setup be its own branch/PR, or folded into the first issue branch (#10)?

3. **Guide content authorship:** The MDX guide content (especially #9's best-of guides) requires product knowledge and editorial voice. Are these AI-drafted with human editing, or human-written with AI scaffolding the template?

4. **Comparison table data source (#11):** The issue says "top 10-15 mice" but the API may not have that many mice yet. Should the page gracefully show however many mice exist, or hard-gate on a minimum count?

5. **Deal Card design (#13):** Since the API endpoint doesn't exist yet, should we include a few hard-coded mock deals for visual development, or ship with just the empty state?

---

## Estimated Commit Count

| Issue | Commits | Notes |
|-------|---------|-------|
| Shared infra | 3 | MDX, collections, ArticleLayout |
| #9 Best Of Guides | 4 | component, routes, content, nav |
| #10 Learn Hub | 4 | layout, routes, content, nav |
| #11 Comparison Table | 2 | page + nav link |
| #12 Buying Guide | 1 | single MDX file (routes from #9) |
| #13 Deal Tracker | 4 | types, component, page, nav |
| #14 Mousepad Filtering | 2 | helpers + enhanced page |
| **Total** | **20** | |
