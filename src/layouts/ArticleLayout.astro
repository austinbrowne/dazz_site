---
import BaseLayout from './BaseLayout.astro';

interface BreadcrumbItem {
  label: string;
  href?: string;
}

interface Props {
  title: string;
  description?: string;
  /** Breadcrumb trail — last item is rendered as current page (no link) */
  breadcrumbs?: BreadcrumbItem[];
  /** ISO date string for "Last updated" display */
  lastUpdated?: Date;
  /** Open Graph image override */
  ogImage?: string;
}

const {
  title,
  description,
  breadcrumbs = [],
  lastUpdated,
  ogImage,
} = Astro.props;

const formattedDate = lastUpdated && !isNaN(lastUpdated.getTime())
  ? lastUpdated.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })
  : null;

const hasSidebar = Astro.slots.has('sidebar');
const hasToc = Astro.slots.has('toc');
---

<BaseLayout title={title} description={description} ogType="article" ogImage={ogImage}>
  <div class="max-w-6xl mx-auto px-4 py-8">
    {/* Breadcrumb */}
    {breadcrumbs.length > 0 && (
      <nav aria-label="Breadcrumb" class="mb-6">
        <ol class="flex items-center gap-2 text-sm text-zinc-400">
          {breadcrumbs.map((crumb, index) => {
            const isLast = index === breadcrumbs.length - 1;
            return (
              <>
                {index > 0 && (
                  <li aria-hidden="true" class="text-zinc-600">/</li>
                )}
                <li>
                  {isLast ? (
                    <span aria-current="page" class="text-zinc-200 truncate">{crumb.label}</span>
                  ) : crumb.href ? (
                    <a href={crumb.href} class="hover:text-white transition-colors">{crumb.label}</a>
                  ) : (
                    <span>{crumb.label}</span>
                  )}
                </li>
              </>
            );
          })}
        </ol>
      </nav>
    )}

    {/* Article header */}
    <header class="mb-8">
      <h1 class="text-3xl md:text-4xl font-bold text-white mb-3">{title}</h1>
      {formattedDate && (
        <p class="text-sm text-zinc-400">
          Last updated: <time datetime={lastUpdated!.toISOString().split('T')[0]}>{formattedDate}</time>
        </p>
      )}
    </header>

    {/* Main content area — with optional sidebar */}
    <div class={hasSidebar ? 'flex flex-col lg:flex-row gap-8' : ''}>
      {/* Sidebar (rendered on left for desktop, above content on mobile) */}
      {hasSidebar && (
        <aside class="lg:w-64 lg:shrink-0">
          <slot name="sidebar" />
        </aside>
      )}

      <div class={hasSidebar ? 'flex-1 min-w-0' : ''}>
        {/* Table of contents slot */}
        {hasToc && (
          <nav aria-label="Table of contents" class="mb-8 p-4 bg-zinc-900 border border-zinc-800 rounded-lg">
            <h2 class="text-sm font-semibold text-white mb-3">On this page</h2>
            <slot name="toc" />
          </nav>
        )}

        {/* Prose content — MDX renders here */}
        <article class="prose prose-invert prose-zinc max-w-none prose-headings:scroll-mt-20 prose-a:text-indigo-400 prose-a:no-underline hover:prose-a:underline">
          <slot />
        </article>
      </div>
    </div>
  </div>
</BaseLayout>
