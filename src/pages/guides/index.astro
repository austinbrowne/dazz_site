---
import BaseLayout from '../../layouts/BaseLayout.astro';
import EmptyState from '../../components/EmptyState.astro';
import { getCollection } from 'astro:content';

const allGuides = await getCollection('guides');

// Sort by lastUpdated descending (newest first)
const guides = allGuides.sort((a, b) => {
  const dateA = a.data.lastUpdated.getTime();
  const dateB = b.data.lastUpdated.getTime();
  return dateB - dateA;
});

const hasGuides = guides.length > 0;
---

<BaseLayout title="Guides" description="Best-of guides for gaming peripherals. Curated product recommendations for mice, keyboards, mousepads, IEMs, and more.">
  <div class="max-w-6xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-white mb-2">Guides</h1>
    <p class="text-zinc-400 mb-8">Curated best-of lists and buying guides for gaming peripherals.</p>

    {hasGuides ? (
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        {guides.map((guide) => {
          const formattedDate = guide.data.lastUpdated.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
          });

          return (
            <a
              href={`/guides/${guide.id}`}
              class="group block bg-zinc-900 border border-zinc-800 rounded-xl p-6 hover:border-zinc-700 transition-colors"
            >
              <h2 class="text-lg font-semibold text-white mb-2 group-hover:text-indigo-400 transition-colors">
                {guide.data.title}
              </h2>
              <p class="text-sm text-zinc-400 mb-4 line-clamp-3">{guide.data.description}</p>
              <div class="flex items-center justify-between text-xs text-zinc-500">
                <time datetime={guide.data.lastUpdated.toISOString().split('T')[0]}>
                  {formattedDate}
                </time>
                {guide.data.category && (
                  <span class="px-2 py-0.5 bg-zinc-800 rounded text-zinc-400">{guide.data.category}</span>
                )}
              </div>
            </a>
          );
        })}
      </div>
    ) : (
      <EmptyState
        title="Guides coming soon"
        description="Best-of guides and buying recommendations are being written. Check back soon or subscribe to the newsletter."
        ctaText="Go Home"
        ctaHref="/"
      />
    )}
  </div>
</BaseLayout>
