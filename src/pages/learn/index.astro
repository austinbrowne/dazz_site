---
import BaseLayout from '../../layouts/BaseLayout.astro';
import EmptyState from '../../components/EmptyState.astro';
import { getCollection } from 'astro:content';

const allArticles = await getCollection('learn');

// Group articles by section, then sort within each group by order
const sectionMap = new Map<string, typeof allArticles>();

for (const article of allArticles) {
  const section = article.data.section;
  if (!sectionMap.has(section)) {
    sectionMap.set(section, []);
  }
  sectionMap.get(section)!.push(article);
}

// Sort articles within each section by order
for (const articles of sectionMap.values()) {
  articles.sort((a, b) => a.data.order - b.data.order);
}

// Sort sections alphabetically for consistent ordering
const sections = [...sectionMap.entries()].sort(([a], [b]) => a.localeCompare(b));

const hasArticles = allArticles.length > 0;
---

<BaseLayout title="Learn" description="Educational articles about hall effect keyboards, TMR sensors, rapid trigger, analog input, and more gaming peripheral technology.">
  <div class="max-w-6xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-white mb-2">Learn</h1>
    <p class="text-zinc-400 mb-8">Understand the tech behind modern gaming peripherals. Hall effect switches, TMR sensors, rapid trigger, and more.</p>

    {hasArticles ? (
      <div class="space-y-12">
        {sections.map(([sectionName, articles]) => (
          <section>
            <h2 class="text-xl font-semibold text-white mb-4 pb-2 border-b border-zinc-800">
              {sectionName}
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
              {articles.map((article) => (
                <a
                  href={`/learn/${article.id}`}
                  class="group block bg-zinc-900 border border-zinc-800 rounded-xl p-6 hover:border-zinc-700 transition-colors"
                >
                  <h3 class="text-lg font-semibold text-white mb-2 group-hover:text-indigo-400 transition-colors">
                    {article.data.title}
                  </h3>
                  <p class="text-sm text-zinc-400 line-clamp-3">{article.data.description}</p>
                </a>
              ))}
            </div>
          </section>
        ))}
      </div>
    ) : (
      <EmptyState
        title="Articles coming soon"
        description="Educational content about gaming peripheral technology is being written. Check back soon or subscribe to the newsletter."
        ctaText="Go Home"
        ctaHref="/"
      />
    )}
  </div>
</BaseLayout>
